---
phase: 06-safety-features
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - get-shit-done/references/executor/deviation-rules.md
  - get-shit-done/workflows/execute-plan.md
  - get-shit-done/templates/summary.md
autonomous: true

must_haves:
  truths:
    - "Executors can add inline tasks during execution for Rules 1-3 work"
    - "Inline tasks must cite deviation rule that triggered them"
    - "Inline tasks are documented in SUMMARY.md Deviations section"
    - "Inline tasks do not create separate commits (part of parent task)"
  artifacts:
    - path: "get-shit-done/references/executor/deviation-rules.md"
      provides: "Inline task declaration format"
      contains: "type=\"inline\""
    - path: "get-shit-done/workflows/execute-plan.md"
      provides: "Inline task handling during execution"
      contains: "inline"
    - path: "get-shit-done/templates/summary.md"
      provides: "Inline tasks section in deviations"
      contains: "Inline Tasks"
  key_links:
    - from: "get-shit-done/workflows/execute-plan.md"
      to: "get-shit-done/references/executor/deviation-rules.md"
      via: "@ reference"
      pattern: "deviation-rules.md"
    - from: "get-shit-done/templates/summary.md"
      to: "inline tasks tracking"
      via: "Deviations section structure"
      pattern: "Inline Tasks"
---

<objective>
Implement inline task modifications for discovered work during execution.

Purpose: When executors discover work during execution (per deviation rules 1-3), they can now formally declare inline tasks rather than just fixing inline. This provides better tracking and documentation of discovered work while maintaining the autonomous fix capability.

Output: `<task type="inline">` declaration format and SUMMARY.md tracking
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-safety-features/06-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add inline task declaration to deviation-rules.md</name>
  <files>
    get-shit-done/references/executor/deviation-rules.md
  </files>
  <action>
Add new section to `get-shit-done/references/executor/deviation-rules.md` after the existing rules:

## Inline Task Declaration

When Rules 1-3 trigger significant work (more than a quick fix), declare an inline task:

```xml
<task type="inline" deviation-rule="2">
  <name>Add missing input validation</name>
  <reason>Form accepts invalid email format, security vulnerability</reason>
  <files>src/components/LoginForm.tsx</files>
  <action>Add email validation regex, show error message on invalid input</action>
  <verify>Invalid emails rejected, valid emails accepted</verify>
</task>
```

**Required attributes:**
- `type="inline"` - Marks as inline task (not planned)
- `deviation-rule="N"` - Which rule (1, 2, or 3) triggered this task

**When to use inline tasks:**
- Fix is substantial (more than a few lines)
- Fix affects multiple concerns within the file
- Documentation benefit outweighs overhead
- Helps future debugging/understanding

**When NOT to use inline tasks:**
- Quick one-liner fixes (just fix and track in deviations)
- Rule 4 situations (these require returning checkpoint, not inline tasks)

**Inline task characteristics:**
- Part of current task commit (not separate commit)
- Documented in SUMMARY.md Deviations section
- Does NOT require user approval (follows deviation rules)
- Does NOT count against plan task limit

**Process:**
1. Encounter issue during task execution
2. Determine which rule applies (1-3)
3. If substantial: declare inline task with XML format
4. Execute the inline task work
5. Verify inline task done
6. Continue with parent task
7. Include in parent task commit
8. Document in SUMMARY.md
  </action>
  <verify>
    - deviation-rules.md contains "Inline Task Declaration" section
    - XML format example is present
    - Required attributes documented
    - When to use / when not to use guidance present
  </verify>
  <done>
    Inline task declaration format and guidance added to deviation-rules.md
  </done>
</task>

<task type="auto">
  <name>Task 2: Update execute-plan.md and summary.md for inline task handling</name>
  <files>
    get-shit-done/workflows/execute-plan.md
    get-shit-done/templates/summary.md
  </files>
  <action>
1. Update `get-shit-done/workflows/execute-plan.md`:

   In the `<deviation_documentation>` section, add inline task tracking:
   ```
   Document all deviations in Summary using format from deviation-rules.md.
   Track: rule applied, issue, fix, files modified, commit hash.

   For inline tasks specifically:
   - Track task name, deviation rule, reason
   - Include in parent task commit (not separate)
   - Document in SUMMARY.md Deviations > Inline Tasks section
   ```

   In the `<step name="execute">` section, after deviation rules reference, add note:
   ```
   **For substantial Rule 1-3 work:** Declare inline task using format from deviation-rules.md.
   Inline tasks are part of current task commit and documented in Summary.
   ```

2. Update `get-shit-done/templates/summary.md`:

   In the "## Deviations from Plan" section, add Inline Tasks subsection:
   ```markdown
   ## Deviations from Plan

   [Existing deviation tracking format]

   ### Inline Tasks Added

   | Task | Rule | Reason | Files | Commit |
   |------|------|--------|-------|--------|
   | [name] | [1-3] | [why needed] | [files] | [hash] |

   **Total inline tasks:** [N]
   **Impact:** [Brief assessment - e.g., "Critical security fixes, within deviation rules scope"]
   ```

   If no inline tasks, this section can show "None" or be omitted.
  </action>
  <verify>
    - execute-plan.md references inline task handling in deviation documentation
    - execute-plan.md mentions inline tasks in execute step
    - summary.md template has Inline Tasks subsection in Deviations
  </verify>
  <done>
    Execute-plan.md handles inline tasks during execution, summary.md tracks them in Deviations section
  </done>
</task>

</tasks>

<verification>
- [ ] `get-shit-done/references/executor/deviation-rules.md` has Inline Task Declaration section
- [ ] XML format with `type="inline"` and `deviation-rule="N"` documented
- [ ] When to use / when not to use guidance present
- [ ] `get-shit-done/workflows/execute-plan.md` references inline task handling
- [ ] `get-shit-done/templates/summary.md` has Inline Tasks tracking in Deviations
</verification>

<success_criteria>
FEAT-02 complete:
- Inline task XML format documented with required attributes
- Executors know when to use inline tasks vs quick fixes
- Execute-plan.md handles inline tasks during execution
- SUMMARY.md tracks inline tasks in Deviations section
- Inline tasks are part of parent task commit, not separate
</success_criteria>

<output>
After completion, create `.planning/phases/06-safety-features/06-02-SUMMARY.md`
</output>
